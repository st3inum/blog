<!DOCTYPE html>
<html>
<head>
    <title>Spoiler Test</title>
    <style>
        /* Base spoiler styles */
        .spoiler {
            margin: 1em 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        /* Spoiler content */
        .spoiler_block_content {
            padding: 10px 0;
        }

        /* Spoiler header */
        .spoiler_block_show,
        .spoiler_block_hide {
            display: block;
            padding: 10px 15px;
            background-color: #f5f5f5;
            border-bottom: 1px solid #ddd;
            cursor: pointer;
            text-decoration: none;
            color: #333;
        }

        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            .spoiler {
                border-color: #444;
            }
            
            .spoiler_block_show,
            .spoiler_block_hide {
                background-color: #333;
                border-color: #444;
                color: #eee;
            }
        }

        /* Icons for show/hide */
        .spoiler-block-icon-zoom-in::before {
            content: "+ ";
        }

        .spoiler-block-icon-zoom-out::before {
            content: "- ";
        }
    </style>
</head>
<body>
    <h1>Spoiler Test</h1>
    
    <div class="spoiler-shortcode" data-spoiler-title="<b>Constraints</b>" data-spoiler-type="titled">
        <ul>
            <li>$A_{i} \le 2^{60}$</li>
            <li>$n\le 10^{5}$</li>
            <li>$q\le 10^{5}$</li>
            <li>$x \le 2^{60}$</li>
        </ul>
    </div>

    <div class="spoiler-shortcode" data-spoiler-type="simple">
        <p>This is a simple spoiler with <b>bold text</b> and <i>italic text</i>.</p>
    </div>

    <script>
        /**
         * Client-side script to make spoilers interactive - Hugo style
         */
        function initSpoilers() {
            console.log('Initializing Hugo-style spoilers with Markdown support...');
            
            // Process spoiler shortcodes in the content
            processSpoilerShortcodes();
            
            // Set up click handlers for spoiler blocks
            setupSpoilerClickHandlers();
        }

        /**
         * Process spoiler shortcodes and convert them to interactive elements
         */
        function processSpoilerShortcodes() {
            // Process spoiler shortcodes that were preserved during server-side rendering
            const spoilerShortcodes = document.querySelectorAll('.spoiler-shortcode');
            console.log(`Found ${spoilerShortcodes.length} spoiler shortcodes`);
            
            spoilerShortcodes.forEach((spoiler, index) => {
                const spoilerElement = spoiler;
                
                // Skip if this spoiler has already been processed
                if (spoilerElement.classList.contains('spoiler-processed')) {
                    return;
                }
                
                // Mark as processed
                spoilerElement.classList.add('spoiler-processed');
                
                const spoilerType = spoilerElement.getAttribute('data-spoiler-type');
                const title = spoilerElement.getAttribute('data-spoiler-title') || 'click to show';
                const content = spoilerElement.innerHTML;
                
                console.log(`Processing spoiler ${index} of type ${spoilerType} with title: ${title}`);
                
                // Create the Hugo-style spoiler structure
                const spoilerDiv = document.createElement('div');
                spoilerDiv.className = 'spoiler panel panel-default';
                
                const spoilerBlock = document.createElement('div');
                spoilerBlock.className = 'spoiler_block';
                
                // Show link (initially visible) - use innerHTML to preserve HTML in title
                const showLink = document.createElement('a');
                showLink.href = '#';
                showLink.className = 'spoiler-block-icon spoiler-block-icon-zoom-in spoiler_block_show';
                showLink.innerHTML = title; // Use innerHTML to preserve HTML formatting
                
                // Hide link (initially hidden)
                const hideLink = document.createElement('a');
                hideLink.href = '#';
                hideLink.className = 'spoiler-block-icon spoiler-block-icon-zoom-out spoiler_block_hide';
                hideLink.style.display = 'none';
                hideLink.textContent = 'click to hide';
                
                // Content div (initially hidden)
                const contentDiv = document.createElement('div');
                contentDiv.className = 'spoiler_block_content';
                contentDiv.style.display = 'none';
                contentDiv.innerHTML = content; // Content already has HTML formatting
                
                // Assemble the spoiler structure
                spoilerBlock.appendChild(showLink);
                spoilerBlock.appendChild(hideLink);
                spoilerBlock.appendChild(contentDiv);
                spoilerDiv.appendChild(spoilerBlock);
                
                // Replace the original element with our Hugo-style spoiler
                spoilerElement.parentNode?.replaceChild(spoilerDiv, spoilerElement);
            });
        }

        /**
         * Set up click handlers for spoiler blocks (Hugo style)
         */
        function setupSpoilerClickHandlers() {
            // Define selectors for show/hide links and content
            const switchesSelector = '.spoiler_block_show,.spoiler_block_hide';
            const contentSelector = '.spoiler_block_content';
            
            // Add click event listeners to all spoiler switches
            document.addEventListener('click', (event) => {
                const target = event.target;
                
                // Check if the clicked element is a spoiler switch or a child of a spoiler switch
                const clickedSwitch = target.matches(switchesSelector) ? 
                    target : target.closest(switchesSelector);
                
                if (clickedSwitch) {
                    event.preventDefault();
                    
                    // Find the parent spoiler block
                    const spoilerBlock = clickedSwitch.closest('.spoiler_block');
                    if (spoilerBlock) {
                        // Toggle visibility of show/hide links and content
                        const showHideLinks = spoilerBlock.querySelectorAll(switchesSelector);
                        const contentDivs = spoilerBlock.querySelectorAll(contentSelector);
                        
                        showHideLinks.forEach(link => {
                            link.style.display = 
                                link.style.display === 'none' ? 'block' : 'none';
                        });
                        
                        contentDivs.forEach(div => {
                            div.style.display = 
                                div.style.display === 'none' ? 'block' : 'none';
                        });
                    }
                }
            });
        }

        // Initialize spoilers when the page loads
        document.addEventListener('DOMContentLoaded', initSpoilers);
    </script>
</body>
</html>
